<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shopoline.xingyuanji.mapper.AdminInfoMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.shopoline.xingyuanji.entity.AdminInfo">
        <result column="id" property="id" />
        <result column="name" property="name" />
        <result column="userName" property="userName" />
        <result column="passWord" property="passWord" />
        <result column="editBy" property="editBy" />
        <result column="editTime" property="editTime" />
        <result column="deleteFlag" property="deleteFlag" />
        <result column="position" property="position" />
    </resultMap>

    <!--查询用户购物信息-->
    <select id="getUserShopLogInfo" resultType="com.shopoline.xingyuanji.model.UserShopLogInfoModel">
       SELECT c.nickName,a.openId,c.userId,a.addressId,a.id AS shopLogId,a.deleteFlag,a.isDeliver,a.ZIPNum,b.goodsname,a.express,d.name,d.phone,
       a.outTradeNo,a.ZIPOutTradeNo,a.isPay,a.totalFee,a.ZIPAmount,a.updateTime,a.boxId,d.province,d.city,d.area,d.address,a.editTime
       FROM t_shop_log a
	   LEFT JOIN t_product_info b ON b.id = a.goodsId
	   LEFT JOIN t_user_info c ON c.openId = a.openId
	   LEFT JOIN t_user_address d ON d.id = a.addressId
	   WHERE a.openId = #{openId}
       ORDER BY a.editTime DESC
       LIMIT #{pageStart},#{pageSize};
    </select>

    <!--获取全部用户购买记录-->
    <select id="getAllShopLog" resultType="com.shopoline.xingyuanji.model.UserShopLogInfoModel">
        SELECT c.nickName,a.openId,c.userId,a.addressId,a.id AS shopLogId,a.deleteFlag,a.isDeliver,a.ZIPNum,b.goodsname,a.express,d.NAME,d.phone,a.outTradeNo,
                a.ZIPOutTradeNo,a.isPay,a.totalFee,a.ZIPAmount,a.updateTime,a.boxId,d.province,d.city,d.area,d.address,a.editTime
        FROM
        t_shop_log a
        LEFT JOIN t_product_info b ON b.id = a.goodsId
        LEFT JOIN t_user_info c ON c.openId = a.openId
        LEFT JOIN t_user_address d ON d.id = a.addressId
        <if test="openId != 0  or nickName != 0 or days != null">
            WHERE
        </if>
        <if test="openId != 0">
            a.openId = #{openId}
        </if>
        <if test="openId != 0">
            AND
        </if>
        <if test="nickName != 0">
            nickName LIKE #{nickName}
        </if>
        <if test="nickName != 0">
            AND
        </if>
        <if test="days != null ">
            TO_DAYS(NOW()) - TO_DAYS(a.editTime) &lt;= #{days}
        </if>
        ORDER BY a.editTime DESC
        LIMIT #{pageStart},#{pageSize};
    </select>

</mapper>
